@page  "/"

@layout CenteredCardLayout
@inject NavigationManager NavigationManager


<center>
    <div>
        <br /><br /><br /><br /><br />
    </div>
    <div>
        <h3 style="font-weight:bold; color:#3da081">Zaloguj się</h3>
    </div>
    <div>
        <br />
    </div>
    <EditForm Model="Log">
        <DataAnnotationsValidator />
        <div class="col-12 row">
            <input class="form-control col-12" placeholder="email/id" @bind-value="Log.Login" />
            <ValidationMessage For="@(() => Log.Login)" />
        </div>
        <br />
        <div class="col-12 row">
            <input type="password" class="form-control col-12" placeholder="hasło" @bind-value="Log.Password" />
            <ValidationMessage For="@(() => Log.Password)" />
        </div>
        <br />
        <div class="col-12 row">
            <span class="col-12"></span>
            <input type="submit" class="form-control col-6 btn btn-primary" @onclick="LoginSubmit" value="Zaloguj się" />
            <a href="/signup" class="col-6">Rejestracja</a>
        </div>
        <br />
        <div class="col-12 row" style="text-align:left; font-weight:bold">
            <span class="col-12"></span>
        </div>
    </EditForm>
</center>


@code{

            SfToast ToastObj;
            private string ToastContent { get; set; } = "Błędne dane logowania.";

            // tworzmy obiekt do przechowywania informacji o zalogowanym uzytkowniku
            public static BackendLibrary.Models.EmployeeModel UserLoggedIn = new BackendLibrary.Models.EmployeeModel();

            private BackendLibrary.Validation.LoginValidation Log = new BackendLibrary.Validation.LoginValidation();

            private void LoginSubmit()
            {
                // tutaj nastepuje przypisanie wszystkich wartosci do obiektu UserLoggedIn, zgodnie z podanym loginem i haslem
                UserLoggedIn = BackendLibrary.DataAccess.EmployeeData.LoginEmployee(Log.Login, Log.Password);


            
           

        if (Log.Login != null && Log.Password != null)
        {
            try
            {
                // 0 jest dla zyklego pracownika
                if (UserLoggedIn.If_manager == 0)
                {
                    NavigationManager.NavigateTo("/kanban");
                }

                // 1 jest dla managera a 2 dla bosa
                else if (UserLoggedIn.If_manager == 1 || UserLoggedIn.If_manager == 2)
                {
                    NavigationManager.NavigateTo("/kanban");
                }
            }

            catch(Exception ex)
    {
        Log.invalidData = true;
        ToastObj.Show();
    }

        }
    }

    private void HandleValidSubmit()
    {

    }
}
